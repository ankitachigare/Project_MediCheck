<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Check Appointment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="appoinstyle.css">
</head>
<body>
    <br><br>
    <div class="container-fluid mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8 col-sm-12">
                <div class="card p-4 shadow-sm"><br><br>
                    <h4 class="mb-3 text-center">Request an Appointment</h4><br><br>
                    <form id="appointmentForm">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="fullName" placeholder="Enter your full name">
                            <label for="fullName">Full Name</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="email" placeholder="Enter your email">
                            <label for="email">Email Address</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="tel" class="form-control" id="phone" placeholder="Enter your phone number">
                            <label for="phone">Phone Number</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="date" class="form-control" id="date">
                            <label for="date">Preferred Date</label>
                        </div>
                        <div class="form-floating mb-3">
                            <textarea class="form-control" id="additionalInfo" rows="3" placeholder="Any specific concerns or requirements?" style="height: 100px;"></textarea>
                            <label for="additionalInfo">Address & Preferred Time For Sample Collection.</label>
                            <div class="char-counter" id="charCounter">0/250</div>
                        </div>
                        <div class="dropdown">
                            <button type="button" class="dropdown-btn">Select Services ▼</button>
                            <div class="dropdown-content" id="dropdownMenu">
                                <label><input type="checkbox" value="General Checkup" data-price="5999"> Executive Health Package (₹5,999)</label>
                                <label><input type="checkbox" value="Blood Test" data-price="399"> Blood Test (₹399)</label>
                                <label><input type="checkbox" value="Heart Health Screening" data-price="1199"> Advanced Imaging (₹1,199)</label>
                                <label><input type="checkbox" value="Hormone Panel" data-price="499"> Hormone Panel  (₹499)</label>
                                <label><input type="checkbox" value="Allergy Testing" data-price="6000"> Allergy Testing (₹6,000)</label>
                                <label><input type="checkbox" value="Diabetes Test (HbA1c & Fasting Glucose)" data-price="1000"> Diabetes Test (HbA1c & Fasting Glucose) (₹1,000)</label>
                                <label><input type="checkbox" value="Vitamin D Test" data-price="500"> Vitamin D Test (₹500)</label>
                                <label><input type="checkbox" value="Vitamin B12 Test" data-price="500"> Vitamin B12 Test (₹500)</label>
                                <label><input type="checkbox" value="COVID-19 PCR Test" data-price="900"> COVID-19 PCR Test (₹900)</label>
                                <label><input type="checkbox" value="DNA Test" data-price="14000"> DNA Test (₹14,000)</label>
                                <label><input type="checkbox" value="STD Panel" data-price="4500"> STD Panel (₹4,500)</label>
                                <label><input type="checkbox" value="Advanced Imaging" data-price="3500"> Advanced Imaging (₹3,500)</label>

                            </div>
                            <div class="mt-3">
                                <strong>Total Amount: ₹<span id="totalAmount">0</span></strong>
                            </div>                            
                        </div>
                        <br><br>
                        <button type="button" class="btn btn-primary w-100" id="proceedToPayment" disabled>Proceed to Payment</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid mt-3 d-none" id="paymentSection">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8 col-sm-12">
                <div class="card p-4 shadow-sm">
                    <h4 class="mb-3 text-center">Enter Payment Details</h4>
                    <form id="paymentForm">
                        <div class="mb-3 ">
                            <strong>Total Payable Amount: ₹<span id="totalPaymentAmount">0</span></strong>
                        </div>
                        
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="cardName" placeholder="Cardholder's Name">
                            <label for="cardName">Cardholder's Name</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="cardNumber" placeholder="Card Number">
                            <label for="cardNumber">Card Number</label>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY">
                                    <label for="expiryDate">Expiry Date (MM/YY)</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="cvv" placeholder="CVV">
                                    <label for="cvv">CVV</label>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success w-100" id="confirmAppointment" disabled>Confirm Appointment</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("appointmentForm");
            const inputs = form.querySelectorAll("input, select, textarea");
            const proceedToPayment = document.getElementById("proceedToPayment");
            const charCounter = document.getElementById("charCounter");
            const additionalInfo = document.getElementById("additionalInfo");
            const paymentSection = document.getElementById("paymentSection");
            const paymentInputs = document.getElementById("paymentForm").querySelectorAll("input");
            const confirmAppointment = document.getElementById("confirmAppointment");
                const fullName = document.getElementById("fullName");
                const email = document.getElementById("email");
                const phone = document.getElementById("phone");
                const date = document.getElementById("date");

                // Function to validate fields
                function validateField(input, pattern = null) {
                    if (input.value.trim() === "" || (pattern && !pattern.test(input.value))) {
                        input.classList.add("is-invalid");
                        input.classList.remove("is-valid");
                        return false;
                    } else {
                        input.classList.remove("is-invalid");
                        input.classList.add("is-valid");
                        return true;
                    }
                }

                // Validate Additional Info Character Count
                additionalInfo.addEventListener("input", function () {
                    const maxLength = 250;
                    const currentLength = additionalInfo.value.length;
                    charCounter.textContent = `${currentLength}/${maxLength}`;
                    if (currentLength > maxLength) {
                        additionalInfo.classList.add("is-invalid");
                    } else {
                        additionalInfo.classList.remove("is-invalid");
                    }
                });
            

                // Real-time validation
                fullName.addEventListener("input", () => validateField(fullName));
                email.addEventListener("input", () => validateField(email, /^[^\s@]+@[^\s@]+\.[^\s@]+$/));
                phone.addEventListener("input", () => validateField(phone, /^[0-9]{10}$/));
                date.addEventListener("input", () => validateField(date));

                // Form Submission
                form.addEventListener("submit", function (event) {
                    let isValid = true;

                    if (!validateField(fullName)) isValid = false;
                    if (!validateField(email, /^[^\s@]+@[^\s@]+\.[^\s@]+$/)) isValid = false;
                    if (!validateField(phone, /^[0-9]{10}$/)) isValid = false;
                    if (!validateField(date)) isValid = false;
                    if (additionalInfo.value.length > 250) {
                        additionalInfo.classList.add("is-invalid");
                        isValid = false;
                    }

                    if (!isValid) {
                        event.preventDefault(); // Stop form submission if validation fails
                    }
                });
            




            // Function to check if all fields are filled
            function checkFormValidity() {
                proceedToPayment.disabled = ![...inputs].every(input => input.value.trim() !== "");
            }

            inputs.forEach(input => {
                input.addEventListener("input", checkFormValidity);
            });

            // Character counter for additional info textarea
            additionalInfo.addEventListener("input", function () {
                charCounter.textContent = `${additionalInfo.value.length}/250`;
                if (additionalInfo.value.length > 250) {
                    additionalInfo.value = additionalInfo.value.substring(0, 250);
                    charCounter.textContent = "250/250";
                }
            });

            // Dropdown toggle
            const dropdownBtn = document.querySelector(".dropdown-btn");
            const dropdownMenu = document.getElementById("dropdownMenu");

            if (dropdownBtn && dropdownMenu) {
                dropdownBtn.addEventListener("click", function (event) {
                    event.stopPropagation(); // Prevents the document click listener from immediately closing the dropdown
                    dropdownMenu.classList.toggle("show");
                });

                // Close dropdown when clicking outside
                document.addEventListener("click", function (event) {
                    if (!dropdownMenu.contains(event.target) && !dropdownBtn.contains(event.target)) {
                        dropdownMenu.classList.remove("show");
                    }
                });
            }

                
                const checkboxes = document.querySelectorAll("#dropdownMenu input[type='checkbox']");
                const totalAmountDisplay = document.getElementById("totalAmount");
                const totalPaymentAmountDisplay = document.getElementById("totalPaymentAmount");

                function updateTotalAmount() {
                    let total = 0;
                    checkboxes.forEach(checkbox => {
                        if (checkbox.checked) {
                            total += parseInt(checkbox.getAttribute("data-price"));
                        }
                    });

                    totalAmountDisplay.textContent = total;
                }

                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener("change", updateTotalAmount);
                });

            // Proceed to payment logic
            proceedToPayment.addEventListener("click", function () {
                form.parentElement.style.display = "none"; // Hide booking form
                paymentSection.classList.remove("d-none"); // Show payment section
                paymentSection.scrollIntoView({ behavior: "smooth" });
                 
                 // Transfer total amount to payment section
                 totalPaymentAmountDisplay.textContent = totalAmountDisplay.textContent;
            });

            const cardName = document.getElementById("cardName");
            const cardNumber = document.getElementById("cardNumber");
            const expiryDate = document.getElementById("expiryDate");
            const cvv = document.getElementById("cvv");

            // Function to check overall validity
            function checkPaymentValidity() {
                const isValid = validateCardName() && validateCardNumber() && validateExpiryDate() && validateCVV();
                confirmAppointment.disabled = !isValid;
            }

            // Validate Cardholder Name (Only letters and spaces)
            function validateCardName() {
                if (/^[a-zA-Z\s]+$/.test(cardName.value.trim())) {
                    cardName.classList.remove("is-invalid");
                    return true;
                } else {
                    cardName.classList.add("is-invalid");
                    return false;
                }
            }

            // Validate Card Number (16-digit numeric)
            function validateCardNumber() {
                if (/^\d{16}$/.test(cardNumber.value.trim())) {
                    cardNumber.classList.remove("is-invalid");
                    return true;
                } else {
                    cardNumber.classList.add("is-invalid");
                    return false;
                }
            }

            // Validate Expiry Date (MM/YY format & future date)
            function validateExpiryDate() {
                const value = expiryDate.value.trim();
                if (!/^\d{2}\/\d{2}$/.test(value)) {
                    expiryDate.classList.add("is-invalid");
                    return false;
                }
                const [month, year] = value.split("/").map(Number);
                const currentYear = new Date().getFullYear() % 100;
                const currentMonth = new Date().getMonth() + 1;
                if (month < 1 || month > 12 || year < currentYear || (year === currentYear && month < currentMonth)) {
                    expiryDate.classList.add("is-invalid");
                    return false;
                }
                expiryDate.classList.remove("is-invalid");
                return true;
            }

            // Validate CVV (3 or 4-digit numeric)
            function validateCVV() {
                if (/^\d{3,4}$/.test(cvv.value.trim())) {
                    cvv.classList.remove("is-invalid");
                    return true;
                } else {
                    cvv.classList.add("is-invalid");
                    return false;
                }
            }

            // Auto-format Expiry Date (MM/YY)
            expiryDate.addEventListener("input", function () {
                let value = expiryDate.value.replace(/\D/g, ""); // Remove non-digits
                if (value.length >= 2) {
                    expiryDate.value = value.slice(0, 2) + "/" + value.slice(2, 4);
                }
            });

            // Add event listeners for real-time validation
            cardName.addEventListener("input", () => { validateCardName(); checkPaymentValidity(); });
            cardNumber.addEventListener("input", () => { validateCardNumber(); checkPaymentValidity(); });
            expiryDate.addEventListener("input", () => { validateExpiryDate(); checkPaymentValidity(); });
            cvv.addEventListener("input", () => { validateCVV(); checkPaymentValidity(); });

            checkPaymentValidity(); // Run initially to disable button if needed
                });

                document.getElementById("confirmAppointment").addEventListener("click", function (event) {
                event.preventDefault(); // Prevents the form from submitting

                alert("Your appointment has been successfully booked! You will receive a confirmation email shortly.");

                // Optionally, you can redirect to another page
                // window.location.href = "success.html"; // Change 'success.html' if needed
    });


    </script>
</body>
</html>
